(()=>{"use strict";const e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"a86aba58-abf0-4ce7-8347-0d661387097c","Content-Type":"application/json"}},t=()=>fetch(`${e.baseUrl}/users/me`,{headers:e.headers}),o=t=>fetch(`${e.baseUrl}/cards/${t}`,{method:"DELETE",headers:e.headers}),n=t=>fetch(`${e.baseUrl}/cards/likes/${t}`,{method:"PUT",headers:e.headers}),r=t=>fetch(`${e.baseUrl}/cards/likes/${t}`,{method:"DELETE",headers:e.headers}),c=document.querySelector(".picture-popup"),s=document.querySelector(".picture-popup__image"),a=document.querySelector(".picture-popup__name"),l=document.querySelector(".template").content;function i(e){"Escape"===e.key&&f(document.querySelector(".popup_opened"))}function u(e,t){e.querySelector(".element__bucket").addEventListener("click",(function(){e.remove(),o(t)}))}function d(e,t){const o=e.querySelector(".element__feedback-like");o.addEventListener("click",(function(){o.classList.toggle("element__feedback-like_active"),o.classList.contains("element__feedback-like_active")?n(t).then((e=>e.ok?e.json():Promise.reject(e.status))).then((t=>{console.log("new likes",t.likes.length),e.querySelector(".element__feedback-like-number").textContent=t.likes.length,e.querySelector(".element__feedback-like-number").classList.remove("element__feedback-like-number_inactive")})):r(t).then((e=>e.ok?e.json():Promise.reject(e.status))).then((t=>{console.log("new likes",t.likes.length),0===t.likes.length?e.querySelector(".element__feedback-like-number").classList.add("element__feedback-like-number_inactive"):e.querySelector(".element__feedback-like-number").textContent=t.likes.length}))}))}function p(e){const t=e.querySelector(".element__img"),o=e.querySelector(".element__feedback-heading");t.setAttribute("alt",o.textContent),t.addEventListener("click",(function(){s.src=t.src,a.textContent=o.textContent,s.setAttribute("alt",o.textContent),y(c)}))}function _(e){const o=l.querySelector(".element").cloneNode(!0);return o.querySelector(".element__img").src=e.link,o.querySelector(".element__feedback-heading").textContent=e.name,p(o),d(o,e._id),u(o,e._id),e.likes.length>0&&(o.querySelector(".element__feedback-like-number").classList.remove("element__feedback-like-number_inactive"),o.querySelector(".element__feedback-like-number").textContent=e.likes.length),t().then((e=>e.ok?e.json():Promise.reject(e.status))).then((t=>{e.owner._id!==t._id&&o.querySelector(".element__bucket").classList.add("element__bucket_disabled");for(let n=0;n<e.likes.length;n++)e.likes[n]._id===t._id&&o.querySelector(".element__feedback-like").classList.add("element__feedback-like_active")})),o}function m(e,t){t.prepend(e)}function f(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",i)}function y(e){e.classList.add("popup_opened"),document.addEventListener("keydown",i)}const b=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(o)):(t.disabled=!1,t.classList.remove(o))};function k(e,t){t.textContent=e?"Сохранение...":"Сохранить"}const v=document.querySelector(".profile-popup"),S=document.querySelector(".profile-popup__form-button"),h=document.querySelector(".card-popup__form-button"),q=document.querySelector(".picture-popup"),L=document.querySelector(".card-popup"),g=document.querySelector(".avatar-popup__form"),E=document.querySelector(".profile__avatar_hovered"),C=document.querySelector(".avatar-popup"),j=document.querySelector(".avatar-popup__close-button"),x=document.querySelector(".avatar-popup__picture");j.addEventListener("click",(function(){f(C)})),E.addEventListener("click",(function(){y(C)})),C.addEventListener("click",(function(e){e.target.classList.contains("avatar-popup")&&f(C)})),q.addEventListener("click",(function(e){e.target.classList.contains("picture-popup__image")||f(q)})),L.addEventListener("click",(function(e){e.target.classList.contains("card-popup")&&f(L)})),v.addEventListener("click",(function(e){e.target.classList.contains("profile-popup")&&f(v)})),document.querySelector(".profile-popup__close-button").addEventListener("click",(function(){f(v)}));const P=document.querySelector(".profile-popup__form"),$=P.querySelector(".profile-popup__user-name"),U=P.querySelector(".profile-popup__user-activity");((e={formSelector:"",inputSelector:"",submitButtonSelector:"",inactiveButtonClass:"",inputErrorClass:"",errorClass:""})=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);b(o,n,t.inactiveButtonClass),o.forEach((r=>{r.addEventListener("input",(()=>{((e,t,o,n)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?((e,t,o,n)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.remove(o),r.classList.remove(n),r.textContent=""})(e,t,o,n):((e,t,o,n,r)=>{const c=e.querySelector(`.${t.id}-error`);t.classList.add(n),c.textContent=o,c.classList.add(r)})(e,t,t.validationMessage,o,n)})(e,r,t.inputErrorClass,t.errorClass),b(o,n,t.inactiveButtonClass)}))}))})(t,e)}))})({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_error",errorClass:"popup__error-message_active"});const A=document.querySelector(".profile__info-name"),B=document.querySelector(".profile__info-activity"),T=document.querySelector(".profile__avatar");document.querySelector(".profile__info-button").addEventListener("click",(function(){y(v),S.disabled=!0,S.classList.add("popup__button_inactive")}));const w=document.querySelector(".card-popup");document.querySelector(".profile__add-button").addEventListener("click",(function(){y(w)})),document.querySelector(".card-popup__close-button").addEventListener("click",(function(){f(w)}));const D=document.querySelector(".card-popup__form"),N=document.querySelector(".card-popup__item-name"),O=document.querySelector(".card-popup__item-link"),J=document.querySelector(".picture-popup");document.querySelector(".picture-popup__close-button").addEventListener("click",(function(){f(J)}));const M=document.querySelector(".elements");P.addEventListener("submit",(function(t){t.preventDefault();const o=P.querySelector(".profile-popup__form-button");k(!0,o);const n=U.value;((t,o)=>fetch(`${e.baseUrl}/users/me`,{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:o})}))($.value,n).then((e=>e.ok?e.json():Promise.reject(e.status))).then((e=>{B.textContent=e.about,A.textContent=e.name,f(v)})).finally((()=>{k(!1,o)}))})),D.addEventListener("submit",(function(t){t.preventDefault();const o=N.value,n=O.value,r=D.querySelector(".card-popup__form-button");var c,s;k(!0,r),(c=o,s=n,fetch(`${e.baseUrl}/cards`,{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:s})})).then((e=>e.ok?e.json():Promise.reject(e.status))).then((e=>{console.log("new object",e),m(function(e){const t=l.querySelector(".element").cloneNode(!0);return t.querySelector(".element__img").src=e.link,t.querySelector(".element__feedback-heading").textContent=e.name,p(t),d(t,e._id),u(t,e._id),t}(e),M),f(w),t.target.reset(),h.disabled=!0,h.classList.add("popup__button_inactive")})).finally((()=>{k(!1,r)}))})),g.addEventListener("submit",(function(t){t.preventDefault();const o=g.querySelector(".avatar-popup__form-button");k(!0,o);(t=>fetch(`${e.baseUrl}/users/me/avatar`,{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}))(x.value).then((e=>e.ok?e.json():Promise.reject(e.status))).then((e=>{T.src=e.avatar,f(C),t.target.reset(),o.disabled=!0,o.classList.add("popup__button_inactive")})).finally((()=>{k(!1,o)}))})),t().then((e=>e.ok?e.json():Promise.reject(e.status))).then((e=>{A.textContent=e.name,B.textContent=e.about,T.src=e.avatar,console.log("avatar",e)})),fetch("https://nomoreparties.co/v1/plus-cohort-22/cards",{headers:{authorization:"a86aba58-abf0-4ce7-8347-0d661387097c"}}).then((e=>e.ok?e.json():Promise.reject(e.status))).then((e=>{for(let t=0;t<e.length;t++)m(_(e[t]),M),console.log(e[t].likes.length),console.log(e[t])}))})();