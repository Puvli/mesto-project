(()=>{"use strict";function e(e,t){e?t.textContent="Сохранение...":(t.textContent="Сохранить",t.classList.contains("card-popup__form-button")&&(t.textContent="Создать"))}function t(e){return e.ok?e.json():Promise.reject(e.status)}const o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"a86aba58-abf0-4ce7-8347-0d661387097c","Content-Type":"application/json"}},n=e=>fetch(`${o.baseUrl}/cards/${e}`,{method:"DELETE",headers:o.headers}).then((e=>t(e))),r=e=>fetch(`${o.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:o.headers}).then((e=>t(e))),c=e=>fetch(`${o.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:o.headers}).then((e=>t(e))),l=document.querySelector(".picture-popup"),a=document.querySelector(".picture-popup__image"),s=document.querySelector(".picture-popup__name"),i=document.querySelector(".template").content;function u(e){"Escape"===e.key&&m(document.querySelector(".popup_opened"))}function d(e){const t=i.querySelector(".element").cloneNode(!0),o=t.querySelector(".element__img");return o.src=e.link,o.alt=e.name,t.querySelector(".element__feedback-heading").textContent=e.name,function(e){const t=e.querySelector(".element__img"),o=e.querySelector(".element__feedback-heading");t.setAttribute("alt",o.textContent),t.addEventListener("click",(function(){a.src=t.src,s.textContent=o.textContent,a.setAttribute("alt",o.textContent),f(l)}))}(t),function(e,t){const o=e.querySelector(".element__feedback-like"),n=e.querySelector(".element__feedback-like-number");o.addEventListener("click",(function(){o.classList.contains("element__feedback-like_active")?c(t).then((e=>{console.log("deleted",e.likes),0===e.likes.length?n.classList.add("element__feedback-like-number_inactive"):n.textContent=e.likes.length,o.classList.remove("element__feedback-like_active")})).catch((e=>{console.log(e)})):r(t).then((t=>{o.classList.add("element__feedback-like_active"),console.log("new likes",t.likes),n.textContent=t.likes.length,e.querySelector(".element__feedback-like-number").classList.remove("element__feedback-like-number_inactive")})).catch((e=>{console.log(e)}))}))}(t,e._id),function(e,t){e.querySelector(".element__bucket").addEventListener("click",(function(){n(t).then((()=>{e.remove()})).catch((e=>e))}))}(t,e._id),t}function p(e,t){const o=d(e);e.likes.length>0&&(o.querySelector(".element__feedback-like-number").classList.remove("element__feedback-like-number_inactive"),o.querySelector(".element__feedback-like-number").textContent=e.likes.length),e.owner._id!==t&&function(e){e.querySelector(".element__bucket").classList.add("element__bucket_disabled")}(o);for(let n=0;n<e.likes.length;n++)e.likes[n]._id===t&&o.querySelector(".element__feedback-like").classList.add("element__feedback-like_active");return o}function _(e,t){t.prepend(e)}function m(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",u)}function f(e){e.classList.add("popup_opened"),document.addEventListener("keydown",u)}const v=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(o)):(t.disabled=!1,t.classList.remove(o))},y=document.querySelector(".profile-popup"),b=document.querySelector(".profile-popup__form-button"),h=document.querySelector(".card-popup__form-button"),S=document.querySelector(".picture-popup"),k=document.querySelector(".card-popup"),q=document.querySelector(".avatar-popup__form"),L=document.querySelector(".profile__avatar_hovered"),g=document.querySelector(".avatar-popup"),C=document.querySelector(".avatar-popup__close-button"),E=document.querySelector(".avatar-popup__picture");C.addEventListener("click",(function(){m(g)})),L.addEventListener("click",(function(){f(g)})),g.addEventListener("click",(function(e){e.target.classList.contains("avatar-popup")&&m(g)})),S.addEventListener("click",(function(e){e.target.classList.contains("picture-popup__image")||m(S)})),k.addEventListener("click",(function(e){e.target.classList.contains("card-popup")&&m(k)})),y.addEventListener("click",(function(e){e.target.classList.contains("profile-popup")&&m(y)})),document.querySelector(".profile-popup__close-button").addEventListener("click",(function(){m(y)}));const x=document.querySelector(".profile-popup__form"),$=x.querySelector(".profile-popup__user-name"),U=x.querySelector(".profile-popup__user-activity");((e={formSelector:"",inputSelector:"",submitButtonSelector:"",inactiveButtonClass:"",inputErrorClass:"",errorClass:""})=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);v(o,n,t.inactiveButtonClass),o.forEach((r=>{r.addEventListener("input",(()=>{((e,t,o,n)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?((e,t,o,n)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.remove(o),r.classList.remove(n),r.textContent=""})(e,t,o,n):((e,t,o,n,r)=>{const c=e.querySelector(`.${t.id}-error`);t.classList.add(n),c.textContent=o,c.classList.add(r)})(e,t,t.validationMessage,o,n)})(e,r,t.inputErrorClass,t.errorClass),v(o,n,t.inactiveButtonClass)}))}))})(t,e)}))})({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_error",errorClass:"popup__error-message_active"});const A=document.querySelector(".profile__info-name"),B=document.querySelector(".profile__info-activity"),T=document.querySelector(".profile__avatar");document.querySelector(".profile__info-button").addEventListener("click",(function(){f(y),b.disabled=!0,b.classList.add("popup__button_inactive")}));const P=document.querySelector(".card-popup");document.querySelector(".profile__add-button").addEventListener("click",(function(){f(P)})),document.querySelector(".card-popup__close-button").addEventListener("click",(function(){m(P)}));const j=document.querySelector(".card-popup__form"),w=document.querySelector(".card-popup__item-name"),D=document.querySelector(".card-popup__item-link"),N=document.querySelector(".picture-popup");document.querySelector(".picture-popup__close-button").addEventListener("click",(function(){m(N)}));const O=document.querySelector(".elements");x.addEventListener("submit",(function(n){n.preventDefault();const r=x.querySelector(".profile-popup__form-button");e(!0,r);const c=U.value;((e,n)=>fetch(`${o.baseUrl}/users/me`,{method:"PATCH",headers:o.headers,body:JSON.stringify({name:e,about:n})}).then((e=>t(e))))($.value,c).then((e=>{B.textContent=e.about,A.textContent=e.name,m(y)})).catch((e=>{console.log(e)})).finally((()=>{e(!1,r)}))})),j.addEventListener("submit",(function(n){n.preventDefault();const r=w.value,c=D.value,l=j.querySelector(".card-popup__form-button");var a,s;e(!0,l),(a=r,s=c,fetch(`${o.baseUrl}/cards`,{method:"POST",headers:o.headers,body:JSON.stringify({name:a,link:s})}).then((e=>t(e)))).then((e=>{console.log("new object",e),_(d(e),O),m(P),n.target.reset(),h.disabled=!0,h.classList.add("popup__button_inactive")})).catch((e=>{console.log(e)})).finally((()=>{e(!1,l)}))})),q.addEventListener("submit",(function(n){n.preventDefault();const r=q.querySelector(".avatar-popup__form-button");e(!0,r);(e=>fetch(`${o.baseUrl}/users/me/avatar`,{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:e})}).then((e=>t(e))))(E.value).then((e=>{T.src=e.avatar,m(g),n.target.reset(),r.disabled=!0,r.classList.add("popup__button_inactive")})).catch((e=>{console.log(e)})).finally((()=>{e(!1,r)}))})),Promise.all([fetch(`${o.baseUrl}/users/me`,{headers:o.headers}).then((e=>t(e))),fetch(`${o.baseUrl}/cards`,{headers:o.headers}).then((e=>t(e)))]).then((([e,t])=>{console.log("json",t),A.textContent=e.name,B.textContent=e.about,T.src=e.avatar,console.log("profile",e);for(let o=0;o<t.length;o++)_(p(t[o],e._id),O),console.log(t[o].likes.length),console.log(t[o])})).catch((e=>{console.log(e)}))})();