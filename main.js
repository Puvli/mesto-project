(()=>{"use strict";const e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"a86aba58-abf0-4ce7-8347-0d661387097c","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject(e.status)}const o=o=>fetch(`${e.baseUrl}/cards/${o}`,{method:"DELETE",headers:e.headers}).then((e=>t(e))),n=o=>fetch(`${e.baseUrl}/cards/likes/${o}`,{method:"PUT",headers:e.headers}).then((e=>t(e))),r=o=>fetch(`${e.baseUrl}/cards/likes/${o}`,{method:"DELETE",headers:e.headers}).then((e=>t(e))),c=document.querySelector(".picture-popup"),l=document.querySelector(".picture-popup__image"),a=document.querySelector(".picture-popup__name"),s=document.querySelector(".template").content;function i(e){"Escape"===e.key&&_(document.querySelector(".popup_opened"))}function u(e){const t=s.querySelector(".element").cloneNode(!0),i=t.querySelector(".element__img");return i.src=e.link,i.alt=e.name,t.querySelector(".element__feedback-heading").textContent=e.name,function(e){const t=e.querySelector(".element__img"),o=e.querySelector(".element__feedback-heading");t.addEventListener("click",(function(){l.src=t.src,a.textContent=o.textContent,l.setAttribute("alt",o.textContent),m(c)}))}(t),function(e,t){const o=e.querySelector(".element__feedback-like"),c=e.querySelector(".element__feedback-like-number");o.addEventListener("click",(function(){o.classList.contains("element__feedback-like_active")?r(t).then((e=>{console.log("deleted",e.likes),0===e.likes.length?c.classList.add("element__feedback-like-number_inactive"):c.textContent=e.likes.length,o.classList.remove("element__feedback-like_active")})).catch((e=>{console.log(e)})):n(t).then((t=>{o.classList.add("element__feedback-like_active"),console.log("new likes",t.likes),c.textContent=t.likes.length,e.querySelector(".element__feedback-like-number").classList.remove("element__feedback-like-number_inactive")})).catch((e=>{console.log(e)}))}))}(t,e._id),function(e,t){e.querySelector(".element__bucket").addEventListener("click",(function(){o(t).then((()=>{e.remove()})).catch((e=>e))}))}(t,e._id),t}function d(e,t){const o=u(e);e.likes.length>0&&(o.querySelector(".element__feedback-like-number").classList.remove("element__feedback-like-number_inactive"),o.querySelector(".element__feedback-like-number").textContent=e.likes.length),e.owner._id!==t&&function(e){e.querySelector(".element__bucket").classList.add("element__bucket_disabled")}(o);for(let n=0;n<e.likes.length;n++)e.likes[n]._id===t&&o.querySelector(".element__feedback-like").classList.add("element__feedback-like_active");return o}function p(e,t){t.prepend(e)}function _(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",i)}function m(e){e.classList.add("popup_opened"),document.addEventListener("keydown",i)}const f=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(o)):(t.disabled=!1,t.classList.remove(o))};function v(e,t){e?t.textContent="Сохранение...":(t.textContent="Сохранить",t.classList.contains("card-popup__form-button")&&(t.textContent="Создать"))}const y=document.querySelector(".profile-popup"),b=document.querySelector(".profile-popup__form-button"),h=document.querySelector(".card-popup__form-button"),S=document.querySelector(".picture-popup"),k=document.querySelector(".card-popup"),q=document.querySelector(".avatar-popup__form"),L=document.querySelector(".profile__avatar_hovered"),g=document.querySelector(".avatar-popup"),C=document.querySelector(".avatar-popup__close-button"),E=document.querySelector(".avatar-popup__picture");C.addEventListener("click",(function(){_(g)})),L.addEventListener("click",(function(){m(g)})),g.addEventListener("click",(function(e){e.target.classList.contains("avatar-popup")&&_(g)})),S.addEventListener("click",(function(e){e.target.classList.contains("picture-popup__image")||_(S)})),k.addEventListener("click",(function(e){e.target.classList.contains("card-popup")&&_(k)})),y.addEventListener("click",(function(e){e.target.classList.contains("profile-popup")&&_(y)})),document.querySelector(".profile-popup__close-button").addEventListener("click",(function(){_(y)}));const x=document.querySelector(".profile-popup__form"),$=x.querySelector(".profile-popup__user-name"),U=x.querySelector(".profile-popup__user-activity");((e={formSelector:"",inputSelector:"",submitButtonSelector:"",inactiveButtonClass:"",inputErrorClass:"",errorClass:""})=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);f(o,n,t.inactiveButtonClass),o.forEach((r=>{r.addEventListener("input",(()=>{((e,t,o,n)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?((e,t,o,n)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.remove(o),r.classList.remove(n),r.textContent=""})(e,t,o,n):((e,t,o,n,r)=>{const c=e.querySelector(`.${t.id}-error`);t.classList.add(n),c.textContent=o,c.classList.add(r)})(e,t,t.validationMessage,o,n)})(e,r,t.inputErrorClass,t.errorClass),f(o,n,t.inactiveButtonClass)}))}))})(t,e)}))})({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_error",errorClass:"popup__error-message_active"});const A=document.querySelector(".profile__info-name"),B=document.querySelector(".profile__info-activity"),T=document.querySelector(".profile__avatar");document.querySelector(".profile__info-button").addEventListener("click",(function(){U.value=B.textContent,$.value=A.textContent,m(y),b.disabled=!0,b.classList.add("popup__button_inactive")}));const P=document.querySelector(".card-popup");document.querySelector(".profile__add-button").addEventListener("click",(function(){m(P)})),document.querySelector(".card-popup__close-button").addEventListener("click",(function(){_(P)}));const j=document.querySelector(".card-popup__form"),w=document.querySelector(".card-popup__item-name"),D=document.querySelector(".card-popup__item-link"),N=document.querySelector(".picture-popup");document.querySelector(".picture-popup__close-button").addEventListener("click",(function(){_(N)}));const O=document.querySelector(".elements");x.addEventListener("submit",(function(o){o.preventDefault();const n=x.querySelector(".profile-popup__form-button");v(!0,n);const r=U.value;((o,n)=>fetch(`${e.baseUrl}/users/me`,{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:n})}).then((e=>t(e))))($.value,r).then((e=>{B.textContent=e.about,A.textContent=e.name,_(y)})).catch((e=>{console.log(e)})).finally((()=>{v(!1,n)}))})),j.addEventListener("submit",(function(o){o.preventDefault();const n=w.value,r=D.value,c=j.querySelector(".card-popup__form-button");var l,a;v(!0,c),(l=n,a=r,fetch(`${e.baseUrl}/cards`,{method:"POST",headers:e.headers,body:JSON.stringify({name:l,link:a})}).then((e=>t(e)))).then((e=>{console.log("new object",e),p(u(e),O),_(P),o.target.reset(),h.disabled=!0,h.classList.add("popup__button_inactive")})).catch((e=>{console.log(e)})).finally((()=>{v(!1,c)}))})),q.addEventListener("submit",(function(o){o.preventDefault();const n=q.querySelector(".avatar-popup__form-button");v(!0,n);(o=>fetch(`${e.baseUrl}/users/me/avatar`,{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((e=>t(e))))(E.value).then((e=>{T.src=e.avatar,_(g),o.target.reset(),n.disabled=!0,n.classList.add("popup__button_inactive")})).catch((e=>{console.log(e)})).finally((()=>{v(!1,n)}))})),Promise.all([fetch(`${e.baseUrl}/users/me`,{headers:e.headers}).then((e=>t(e))),fetch(`${e.baseUrl}/cards`,{headers:e.headers}).then((e=>t(e)))]).then((([e,t])=>{console.log("json",t),A.textContent=e.name,B.textContent=e.about,T.src=e.avatar,console.log("profile",e);for(let o=0;o<t.length;o++)p(d(t[o],e._id),O),console.log(t[o].likes.length),console.log(t[o])})).catch((e=>{console.log(e)}))})();